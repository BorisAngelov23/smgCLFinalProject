{% extends 'core/base.html' %}
{% load static %}

{% block content %}
    <link rel="stylesheet" href="{% static 'css/homepage.css' %}">
    <header class="jumbotron jumbotron-fluid text-white text-center position-relative">
        <h1 class="display-4">MATCHES</h1>
    </header>
    <main class="container" style="margin-top: 20px">
        <h1 style="text-align: center">Upcoming</h1>
        <div class="table-responsive">
            <table class="table table-hover table-borderless">
                <tbody>
                    {% for match in matches %}
                        {% if match.status == 'accepted' %}
                            <tr>
                                <td style="font-size: larger">{{ match.team1 }} vs {{ match.team2 }}
                                    <br>{{ match.date }} {{ match.time }}</td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <h1 style="text-align: center">Played</h1>
        <div class="table-responsive">
            <table class="table table-hover table-borderless" style="font-size: larger">
                <tbody>
                    {% for match in matches %}
                        {% if match.status == 'played' %}
                            <tr>
                                <td>
                                    <button class="collapsible" style="text-align: center; font-size: larger" data-match-id="{{ match.pk }}">
                                        {{ match.team1 }} vs. {{ match.team2 }}
                                        <br>{{ match.team1_goals }} - {{ match.team2_goals }}
                                    </button>
                                    <div class="content">
                                        {{ match.date }}, {{ match.time }}
                                        <p style="margin-top: 15px"><strong>Goalscorers:</strong></p>
                                        <ul id="goalscorers-{{ match.pk }}" style="margin-bottom: 15px; color: #0dcaf0"></ul>
                                        <p><strong>MVP:</strong> <a href="{% url 'player_detail' match.mvp.pk %}" style="color: #0dcaf0">{{ match.mvp }}</a></p>
                                    </div>
                                </td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </main>

    <script>
        var coll = document.getElementsByClassName("collapsible");
        var i;

        for (i = 0; i < coll.length; i++) {
            coll[i].addEventListener("click", function() {
                this.classList.toggle("active");
                var content = this.nextElementSibling;
                if (content.style.maxHeight) {
                    content.style.maxHeight = null;
                } else {
                    content.style.maxHeight = content.scrollHeight + "px";
                    var matchId = this.getAttribute("data-match-id");
                    loadGoalscorers(content, matchId);
                }
            });
        }

        function loadGoalscorers(content, matchId) {
            var ul = content.querySelector("#goalscorers-" + matchId);

            fetch("/matches/api/match_goalscorers/" + matchId + "/")
                .then(response => response.json())
                .then(data => {
                    ul.innerHTML = '';
                    data.forEach(stats => {
                        if (stats.goals_scored > 0) {
                            var li = document.createElement("li");
                            var a = document.createElement("a");
                            a.href = "/player/" + stats.player_id + "/";
                            a.textContent = stats.player_name + " (" + stats.goals_scored + " goals)";
                            a.style.color = "#0dcaf0";
                            li.appendChild(a);
                            ul.appendChild(li);
                        }
                    });
                    setTimeout(function() {
                        content.style.maxHeight = content.scrollHeight + ul.scrollHeight + "px";
                    }, 100);
                })
                .catch(error => console.error('Error fetching goalscorers:', error));
        }
    </script>

{% endblock %}
